<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/tr/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>伊利安慕希不踩白格游戏</title>
<meta name="description" content="伊利安慕希不踩白格 抢百万微信红包 I want you！" />
<meta name="viewport" content="width=device-width,inital-scale=0.5,maximum-scale=1, minimum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<style>body {
	MARGIN: 0px;
}
.dialogShadow{
	background-color:rgba(0, 0, 0, 0.4);
	background-size: 170px auto;
	position: absolute ;
	margin: 0 auto;
	width: 100%;
	height: 100%;	
	top:0;
	left:0;
	z-index:1;
	display:none;
}
.dialogBox {
	width:300px;
	height:200px;
	position:absolute;
	z-index:2;
	display: none;
	border:0;
} 
.div1{
	background-image:url('image/dialogbg.png'); 
}
.div2{
	background-image:url('image/dialogbg.png'); 
}
.div3{
	background-image:url('image/dialogbg.png'); 
}
/*当然你可以自定义添加或更改更多的样式都无所谓*/
</style>
<link rel="stylesheet" href="css/style.css">
<link type="text/css" href="css/loader.css" rel="stylesheet"/>
<link rel="stylesheet" href="css/bootstrap.min.css">


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/yahoo-min.js"></script>
<script src="js/event-min.js"></script>
<script src="js/getDevicePixelRatio-min.js"></script>
<script src="js/json2.js"></script>
<script src="js/storage.js"></script>
<script src="js/WechatShare.js"></script>
<script src="js/freeze-touch-move.js"></script>
<script src="js/config.js"></script>

<script type="text/javascript">
//显示的方法，说明：前缀的div1、div2、body等，均为Id值
function showDialogBox(divNum)
{
	var dialogBoxId = "#div"+divNum;
	$("#dialogBox").css("display", "block"); 
	$(dialogBoxId).css("display", "block"); 
	$(dialogBoxId).css("top", window.innerHeight/2-400/2); 
	$(dialogBoxId).css("left", window.innerWidth/2-300/2); 
}

//关闭显示
function closeDialogBox(divNum)
{
	var dialogBoxId = "#div"+divNum;
	$(dialogBoxId).css("display", "none");
	$("#dialogBox").css("display", "none"); 
}
   </script>	
<script type="text/javascript">		
		window.onload = function () {
			orientationchange();
			window.onorientationchange = function () {
				orientationchange();
			}
		}
		function orientationchange() {
			if (window.orientation == undefined) {
				return;
			}
			if (window.orientation == 0 || window.orientation == 180) {
				//竖屏
				document.getElementById("horizontal").style.display = 'none';
			} else {
				//横屏
				document.getElementById("horizontal").style.display = 'block';
			}
		};
		
		
		function tapContainer() {
				
				return function(){
						$("#ad").css("display", "block");						
				};
			};
			
		function tapAd() {
				return function() {
						$("#ad").remove();
						$("#gameCanvas").css("display", "block");						
				};
		};		
		
		
		$(window).ready(function () {	
			
			var canvas = $("#gameCanvas");
			console.log("window.innerWidth=="+window.innerWidth);
			console.log("window.innerHeight=="+window.innerHeight);
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;	
			var ctx = canvas.get(0).getContext("2d");
			ctx.fillStyle = "#0000FF";
			ctx.fillRect(0, 0, canvas.width, canvas.height); 
			if (typeof(window.resolution) == "undefined") {
				window.resolution = {
					"width": $(document).width(),
					"height": $(document).height()
				};
			}	
			$("#container").on("click", tapContainer());
			$("#container").on("tap", tapContainer());
			$("#ad").on("click", tapAd());
			$("#ad").on("tap", tapAd());
			// $("#div1Confirm").on("tap", confirmAndDraw());
			// $("#div1Confirm").on("click", confirmAndDraw());
			// showDialogBox(1);
		});
		
		function confirmAndDraw() {
			alert("success");
			try {
				$.ajax({
					type : 'POST',
					url : "/api/finishgame",
					data : getCsrfToken(),
					dataType : 'json',
					success : function (response) {
						// 根据接口要求  去掉以下代码
						// 1.当用户顺利完成游戏通关后，在用户点击按钮“点击抽取红包”前，前端需要自动的去请求后台接口/api/finishgame，
						// 以便服务器知道当前用户确实完成了游戏(防止某些用户不做游戏直接去刷抽取红包接口），此次请求不要用户交互。
						// 这个步骤，前端不需要处理接口的返回值。
						// var responseObj = JSON.parse(response);		
						// if (0===responseObj.ret && "ok"===responseObj.msg && 0===responseObj.errorcode) {
						// 	var url = window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/draw.html";
						// 	window.location.href = url;
						// }
						// 根据接口要求  增加以下代码
						$.ajax({
							type : 'POST',
							url : "/api/draw",
							data : getCsrfToken(),
							dataType : 'json',
							success : function (drawResult) {
								// 2. 当用户点击按钮“点击抽取红包”时，前端需要去请求后台的/api/draw接口，
								// 正常返回值如下：
								// {
								// 	 ret: 0,
								// 	 msg: “ok“,
								// 	 errorcode: 0,
								// 	 data: {
								// 		 drawRes: 1
								// 	}
								// }
								// 前端需要处理此返回值，
								// 当errorcode为0时，根据drawRes的值(0代表未中奖，1代表中奖，2代表无抽奖机会)显示不同的弹层；
								// 当errorcode不为0时，请直接将msg的值alert给前端用户即可。
								var drawResultObj = JSON.parse(drawResult);		
								if (0===drawResultObj.errorcode) {
									if (0 === drawResultObj.data.drawRes) {
										showDialogBox(2);
									} else if (1 === drawResultObj.data.drawRes) {
										showDialogBox(1);
									} else if (2 === drawResultObj.data.drawRes) {
										showDialogBox(3);
									} else {
										alert("Unsupported value of responseObj.data.drawRes: " + responseObj.data.drawRes);
										return;
									}
								} else {
									alert("Message: " + responseObj.msg);
								}
							},
							error : function (xhr, textStatus, errorThrown) {
								alert("Post-submit (/api/finishgame failed) " + xhr.responseText);	
							}
						});
					},
					error : function (xhr, textStatus, errorThrown) {
						alert("Post-submit (/api/finishgame failed) " + xhr.responseText);	
					}
				});
				
			} catch(err) {
				alert(err)
			}
		};
			
		
		window.onViewBonusEvent = new YAHOO.util.CustomEvent('onViewBonusEvent');
		function viewBonus(event, arguments, obj) {
			try {
				confirmAndDraw();
				// TODO !!!IMPORTANT PLEASE REMOVE TWO LINES OF CODE BELOW IF INTERFACE IS READY!!!  ***********************************************
				var url = window.location.href.substring(0, window.location.href.lastIndexOf('/')) + "/win.html";
				window.location.href = url;
				// TODO !!!IMPORTANT PLEASE REMOVE TWO LINES OF CODE BELOW IF INTERFACE IS READY!!!  ***********************************************
			} catch (err) {
				alert(err);
			}
		}
		window.onViewBonusEvent.subscribe(viewBonus);
		
		$(function () {
			if (navigator.userAgent.match(/iPhone/i) ) { // || navigator.userAgent.match(/iPad/i)
				window.resolution.device = 'iPhone';
			}
		});		
		
		setTimeout(function animate() {
				$('#container').css({"padding-top":"0px"});
				$('#container').css({"padding-bottom":"0px"});		
				$('#gameCanvas').css({"background-color":"#005C87"});
		}, 3000);
		
</script>
<script src="boot-html5.js"></script>
<body>
<div id="horizontal" style="display: none;"></div>
<div id="ad" style="display: none;"></div>
<div id="dialogBox" class="dialogShadow">
	<div id="div1" class="dialogBox div1"><!--么么哒，恭喜你抢到了-->
		   <div id="div13" style="width:100%;height:20px; background-image:url('image/closebar.png'); " align="right">
				   <div onClick="closeDialogBox(1)" style="float:right; width:20px; height:20px;cursor:hand;background-image:url('image/closebt.png');background-repeat: no-repeat;">
				   </div>
		   </div>
		   <div style="margin: 10px; margin-top: 30px; width:100%;height:40%; background-image:url('image/dcontent1.png');background-repeat: no-repeat;" align="center">
		   </div>
			<div id="div1Confirm" style="position:relative;margin-left: auto;
	margin-right: auto; margin-top: 10px; margin-bottom: 10px; width:120px;height:30%; background-image:url('image/confirm.png');background-repeat: no-repeat;" align="center">
		   </div>
	</div>
	<div id="div2" class="dialogBox div2"><!--么么哒，手气不好，-->
		   <div id="div23" style="width:100%;height:20px; background-image:url('image/closebar.png'); " align="right">
				   <div onClick="closeDialogBox(2)" style="float:right; width:20px; height:20px;cursor:hand;background-image:url('image/closebt.png');background-repeat: no-repeat;">
				   </div>
		   </div>
			<div style="position:relative;margin-left: auto;
	margin-right: auto; margin-top: 30px; width:80%;height:40%; background-image:url('image/dcontent2.png');background-repeat: no-repeat;" align="center">
		   </div>
			<div onClick="closeDialogBox(2)" id="div2Confirm" style="position:relative;margin-left: auto;
	margin-right: auto; margin-top: 10px; margin-bottom: 10px; width:120px;height:30%; background-image:url('image/confirm.png');background-repeat: no-repeat;" align="center">
		   </div>
	</div>
	<div id="div3" class="dialogBox div3"><!--么么哒,亲,明天再来哟~-->
		   <div id="div33" style="width:100%;height:20px; background-image:url('image/closebar.png'); " align="right">
				   <div onClick="closeDialogBox(3)" style="float:right; width:20px; height:20px;cursor:hand;background-image:url('image/closebt.png');background-repeat: no-repeat;">
				   </div>
		   </div>
		   
			<div style="position:relative;margin-left: auto;
	margin-right: auto; margin-top: 40px; width:80%;height:30%; background-image:url('image/dcontent3.png');background-repeat: no-repeat;" align="center">
		   </div>
			<div onClick="closeDialogBox(3)" id="div3Confirm" style="position:relative;margin-left: auto;
	margin-right: auto; margin-top: 10px; margin-bottom: 10px; width:120px;height:30%; background-image:url('image/confirm.png');background-repeat: no-repeat;" align="center">
		   </div>
	</div>
</div>
<div id="container">
	<canvas id="gameCanvas">当前浏览器不支持HTML5 Canvas，请更换您的浏览器 </canvas>
</div>
</body>
</HTML>
